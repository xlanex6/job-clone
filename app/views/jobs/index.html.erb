<div id="map" style="width: 100%; height: 400px;"></div>

<% @jobs.each do |job| %>
  <% if job.start_time > DateTime.now-1 %>
<div class="wrapper-grey">
  <div class="container">
    <div class="col-8-sm">
      <div class="jobs">
        <div class="job-infos jobs-item">
            <h4><%= job.title %></h4>
            <h5><%= job.user.company %></h5>
        </div>
        <div class="company-infos jobs-item">
            <p><%= job.content %></p>
        </div>
        <div class="apply-infos jobs-item">
          <div>
              <p><strong>Start:</strong> <%= job.start_time %>
              <p><strong>End:</strong> <%= job.end_time %></p>
          </div>
          <div class="apply-button">
            <%= button_to "Show dÃ©tails", job_path(job.id), :method => :get, class: "btn btn-primary" %>
          </div>
        </div>
      </div>
      </div>
    </div>
</div>
  <% end %>
<% end %>

<div class="container">
  <div class="row">
    <% @jobs.each do |job| %>
      <% if job.start_time > DateTime.now-1 %>
        <%= link_to job.title, job_path(job)%> <br>
        <%= job.content %>
        <ul>
          <li><%= job.start_time %></li>
          <li><%= job.end_time %></li>
          <li><%= job.address %></li>
          <li>by <%= job.user.company %></li>
        </ul>
      <% end %>
    <% end %>
  </div>
</div>

<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    $(document).on('ready', function() {
      var handler = Gmaps.build('Google');
      handler.buildMap({ internal: { id: 'map' } }, function() {
        markers = handler.addMarkers(<%= raw @hash.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
        if (markers.length == 0) {
          handler.getMap().setZoom(2);
        } else if (markers.length == 1) {
          handler.getMap().setZoom(14);
        }
      });
    });
  <% end %>
<% end %>


